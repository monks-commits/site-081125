<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Вибір місць — Ваш Адмін</title>
  <link rel="stylesheet" href="../styles.css" />
  <style>
    body { background:#f4f4f6; }
    .hall-wrap { background:#fff; border-radius:14px; padding:26px; margin-bottom:26px; }
    .hall-row { display:flex; gap:8px; flex-wrap:wrap; }
    .seat {
      width:42px; height:42px; border-radius:10px;
      background:#fff; border:1px solid #d0d5dd;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer; transition:.15s;
    }
    .seat:hover { background:#e5edff; }
    .seat.selected { background:#1d4ed8; color:#fff; border-color:#1d4ed8; }
    .order-form { background:#fff; border-radius:14px; padding:26px; }
    .flex-row { display:flex; gap:16px; flex-wrap:wrap; }
    .form-group { flex:1 1 240px; display:flex; flex-direction:column; gap:6px; }
    .form-group input {
      height:44px; border:1px solid #d0d5dd; border-radius:10px;
      padding:0 12px; font-size:15px;
    }
    .primary-btn {
      background:#155EEF; color:#fff; border:none;
      border-radius:999px; padding:11px 30px;
      font-size:15px; font-weight:600; cursor:pointer;
    }
    .primary-btn:disabled { background:#95b5ff; cursor:not-allowed; }
  </style>
</head>
<body>
  <main class="container" style="max-width:1100px;">
    <h1>Вибір місць</h1>
    <p id="show-label">Вистава: —</p>

    <div class="hall-wrap" id="hall">
      <div class="hall-row" id="hall-seats"></div>
    </div>

    <div class="order-form" id="buyer-form">
      <h2>Дані покупця</h2>
      <div class="flex-row">
        <div class="form-group">
          <label for="buyer-name">Ім’я та прізвище</label>
          <input id="buyer-name" value="Олександр Рябов" />
        </div>
        <div class="form-group">
          <label for="buyer-phone">Телефон</label>
          <input id="buyer-phone" value="+380685160102" />
        </div>
      </div>
      <div class="form-group" style="margin-top:14px;">
        <label for="buyer-email">Електронна пошта (куди надійде PDF-квиток)</label>
        <input id="buyer-email" value="alexandrryabov@ukr.net" />
      </div>
      <p style="margin-top:14px;">
        Вибрано місць: <span id="seat-count">0</span> •
        Сума: <span id="seat-sum">0</span> грн
      </p>
      <button id="to-checkout" class="primary-btn" disabled>Перейти до оплати</button>
    </div>
  </main>

  <script src="../scripts/include.js"></script>
  <script>
    const params = new URLSearchParams(location.search);
    const showSlug = params.get("show") || "shevchenko/ledi";
    document.getElementById("show-label").textContent =
      "Вистава: " + showSlug.replace("/", " — ");

    // простая модель зала: перший ряд 1–20
    const hallSeats = document.getElementById("hall-seats");
    const seats = [];
    for (let i = 1; i <= 20; i++) {
      seats.push({ id: `P1-M${i}`, title: `Ряд 1, Місце ${i}`, price: i <= 10 ? 170 : 140 });
    }

    const selected = new Set();
    const seatCountEl = document.getElementById("seat-count");
    const seatSumEl = document.getElementById("seat-sum");
    const btn = document.getElementById("to-checkout");

    seats.forEach(seat => {
      const div = document.createElement("div");
      div.className = "seat";
      div.textContent = seat.id.split("M")[1];
      div.title = seat.title + " — " + seat.price + " грн";
      div.addEventListener("click", () => {
        if (selected.has(seat.id)) {
          selected.delete(seat.id);
          div.classList.remove("selected");
        } else {
          selected.add(seat.id);
          div.classList.add("selected");
        }
        updateSummary();
      });
      hallSeats.appendChild(div);
    });

    function updateSummary() {
      const ids = Array.from(selected);
      seatCountEl.textContent = ids.length;
      const sum = ids.reduce((acc, id) => {
        const s = seats.find(x => x.id === id);
        return acc + (s ? s.price : 0);
      }, 0);
      seatSumEl.textContent = sum;
      btn.disabled = ids.length === 0;
    }

    btn.addEventListener("click", () => {
      const ids = Array.from(selected);
      const sum = Number(seatSumEl.textContent) || 0;

      // читаем форму
      const name  = document.getElementById("buyer-name").value.trim();
      const phone = document.getElementById("buyer-phone").value.trim();
      const email = document.getElementById("buyer-email").value.trim();

      // Делаем order_id без кириллицы:
      const orderId = "LEDI-" + Date.now();

      const url = new URL(location.origin + "/checkout.html");
      url.searchParams.set("show", showSlug);
      url.searchParams.set("seats", ids.join(","));
      url.searchParams.set("amount", String(sum));
      url.searchParams.set("order_id", orderId);
      // Эти три можно кодировать — но лучше передать чисто
      url.searchParams.set("name", encodeURIComponent(name));
      url.searchParams.set("phone", encodeURIComponent(phone));
      url.searchParams.set("email", encodeURIComponent(email));

      location.href = url.toString();
    });
  </script>
</body>
</html>
