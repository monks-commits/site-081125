<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Вибір місць</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="../styles.css" />
  <style>
    :root{
      --seat-size: 34px;     /* кнопка кресла */
      --gap-x: 6px;          /* горизонтальный зазор между креслами */
      --gap-y: 8px;          /* вертикальный зазор между рядами */
      --aisle-w: 14px;       /* ширина стандартного прохода */
      --aisle-w-lg: 24px;    /* большой проход */
    }
    .wrap{max-width:980px;margin:0 auto;padding:12px;}
    .stage{
      width:100%;text-align:center;background:#1f1f1f;color:#fff;
      padding:10px 12px;border-radius:12px;margin:0 0 12px 0;font-weight:600;letter-spacing:.3px;
    }
    .row{display:flex;align-items:center;gap:var(--gap-x);margin:0 0 var(--gap-y) 0;flex-wrap:wrap}
    .row-label{margin-right:8px;font-size:12px;min-width:34px;text-align:right;font-weight:600;opacity:.75;user-select:none}
    .seats{display:flex;align-items:center;gap:var(--gap-x);flex-wrap:wrap}
    .seat{
      min-width:var(--seat-size);height:var(--seat-size);border-radius:8px;border:1px solid #d0d5dd;
      display:inline-flex;align-items:center;justify-content:center;font-size:13px;background:#fff;cursor:pointer;
      user-select:none;transition:.12s;
    }
    .seat:hover{box-shadow:0 0 0 2px rgba(25,115,255,.15)}
    .seat[aria-pressed="true"]{background:#155eef;color:#fff;border-color:#155eef}
    .seat.taken{opacity:.45;pointer-events:none}
    .aisle{display:inline-block;width:var(--aisle-w)}
    .aisle-lg{display:inline-block;width:var(--aisle-w-lg)}
    .row-break-lg{margin-bottom:18px;border-bottom:2px dashed #eaeaea;padding-bottom:10px}

    .legend{display:flex;gap:18px;align-items:center;margin:10px 0 16px}
    .legend .pill{display:inline-flex;align-items:center;gap:6px;font-size:13px;opacity:.8}
    .pill .dot{width:16px;height:16px;border-radius:6px;border:1px solid #d0d5dd;background:#fff}
    .pill .dot.sel{background:#155eef;border-color:#155eef}
    .pill .dot.off{background:#eee}
    .panel{margin-top:10px;display:grid;gap:8px}
    .panel input{width:100%;padding:10px 12px;border:1px solid #d0d5dd;border-radius:10px}
    .btn-primary{
      width:100%;padding:12px 14px;border-radius:12px;background:#155eef;color:#fff;border:0;font-weight:600;cursor:pointer
    }

    @media(max-width:420px){
      :root{ --seat-size: 30px; --gap-x: 5px; --gap-y: 7px; }
      .row-label{min-width:28px;font-size:11px;margin-right:6px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div id="site-header"></div>

    <main>
      <h1 style="margin:8px 0 12px">Вибір місць</h1>

      <div class="legend">
        <span class="pill"><span class="dot"></span> вільно</span>
        <span class="pill"><span class="dot sel"></span> вибрано</span>
        <span class="pill"><span class="dot off"></span> недоступно</span>
        <span id="show-breadcrumb" style="margin-left:auto;opacity:.7;font-size:13px"></span>
      </div>

      <div id="hall-root">
        <!-- сюда рендерим сцену + ряды -->
      </div>

      <div class="panel">
        <input id="buyer-name" placeholder="Ваше ім’я та прізвище">
        <input id="buyer-phone" placeholder="+380…" >
        <input id="buyer-email" placeholder="you@example.com">
        <div id="summary" style="opacity:.8">Вибрано місць: 0 • Сума: 0 грн</div>
        <button id="pay-btn" class="btn-primary">Перейти до оплати</button>
      </div>
    </main>

    <div id="site-footer" style="margin-top:18px"></div>
  </div>

  <script src="/site-081125/scripts/include.js"></script>
  <script>
// ===================== КОНФИГ ЗАЛОВ =====================

const HALLS = {
  shevchenko: {
    theatreName: "Театр ім. Шевченка",
    hallName: "Велика сцена",
    rows: [
      { row: 1,  seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 170 } ] },
      { row: 2,  seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 200 } ] },
      { row: 3,  seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 200 } ] },
      { row: 4,  seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 180 } ] },
      { row: 5,  seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 180 } ] },
      { row: 6,  seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 180 } ] },
      { row: 7,  seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 170 } ] },
      { row: 8,  seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 170 } ] },
      { row: 9,  seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 160 } ] },
      { row: 10, seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 160 } ] },
      { row: 11, seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 140 } ] },
      { row: 12, seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 140 } ] },
      { row: 13, seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 120 } ] },
      { row: 14, seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 120 } ] },
      { row: 15, seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 100 } ] },
      { row: 16, seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 100 } ] },
      { row: 17, seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 70 } ] },
      { row: 18, seats: 20, aisles: [10], zones: [ { from: 1,  to: 20, price: 70 } ] }
    ]
  },

  academy: {
    theatreName: "Академічний театр \"Академія руху\"",
    hallName: "Велика сцена",
    rows: [
      { row: 1,  seats: 11, offset: 6, aisles: [], zones: [
        { from: 1, to: 11, price: 220 }
      ], gapAfter: false },

      { row: 2,  seats: 23, aisles: [6,17], zones: [
        { from: 1,  to: 6,  price: 160 },
        { from: 7,  to: 17, price: 200 },
        { from: 18, to: 23, price: 160 }
      ]},
      { row: 3,  seats: 23, aisles: [6,17], zones: [
        { from: 1,  to: 6,  price: 160 },
        { from: 7,  to: 17, price: 200 },
        { from: 18, to: 23, price: 160 }
      ]},
      { row: 4,  seats: 23, aisles: [6,17], zones: [
        { from: 1,  to: 6,  price: 160 },
        { from: 7,  to: 17, price: 200 },
        { from: 18, to: 23, price: 160 }
      ]},
      { row: 5,  seats: 23, aisles: [6,17], zones: [
        { from: 1,  to: 6,  price: 160 },
        { from: 7,  to: 17, price: 200 },
        { from: 18, to: 23, price: 160 }
      ]},
      { row: 6,  seats: 23, aisles: [6,17], zones: [
        { from: 1,  to: 6,  price: 160 },
        { from: 7,  to: 17, price: 200 },
        { from: 18, to: 23, price: 160 }
      ], gapAfter: true },

      { row: 7,  seats: 23, aisles: [6,17], zones: [
        { from: 1,  to: 6,  price: 150 },
        { from: 7,  to: 17, price: 190 },
        { from: 18, to: 23, price: 150 }
      ]},

      { row: 8,  seats: 23, aisles: [6,17], zones: [
        { from: 1,  to: 6,  price: 140 },
        { from: 7,  to: 9,  price: 160 },
        { from: 10, to: 14, price: 180 },
        { from: 15, to: 17, price: 160 },
        { from: 18, to: 23, price: 140 }
      ]},
      { row: 9,  seats: 23, aisles: [6,17], zones: [
        { from: 1,  to: 6,  price: 140 },
        { from: 7,  to: 9,  price: 160 },
        { from: 10, to: 14, price: 180 },
        { from: 15, to: 17, price: 160 },
        { from: 18, to: 23, price: 140 }
      ]},
      { row: 10, seats: 23, aisles: [6,17], zones: [
        { from: 1,  to: 6,  price: 140 },
        { from: 7,  to: 9,  price: 160 },
        { from: 10, to: 14, price: 180 },
        { from: 15, to: 17, price: 160 },
        { from: 18, to: 23, price: 140 }
      ]},
      { row: 11, seats: 23, aisles: [6,17], zones: [
        { from: 1,  to: 6,  price: 140 },
        { from: 7,  to: 9,  price: 160 },
        { from: 10, to: 14, price: 180 },
        { from: 15, to: 17, price: 160 },
        { from: 18, to: 23, price: 140 }
      ]},
      { row: 12, seats: 23, aisles: [6,17], zones: [
        { from: 1,  to: 6,  price: 140 },
        { from: 7,  to: 9,  price: 160 },
        { from: 10, to: 14, price: 180 },
        { from: 15, to: 17, price: 160 },
        { from: 18, to: 23, price: 140 }
      ]},
      { row: 13, seats: 23, aisles: [6,17], zones: [
        { from: 1,  to: 6,  price: 140 },
        { from: 7,  to: 9,  price: 160 },
        { from: 10, to: 14, price: 180 },
        { from: 15, to: 17, price: 160 },
        { from: 18, to: 23, price: 140 }
      ]},

      { row: 14, seats: 23, aisles: [6,17], zones: [
        { from: 1, to: 23, price: 130 }
      ]},
      { row: 15, seats: 23, aisles: [6,17], zones: [
        { from: 1, to: 23, price: 130 }
      ]},
      { row: 16, seats: 23, aisles: [6,17], zones: [
        { from: 1, to: 23, price: 130 }
      ], gapAfter: true },

      { row: 17, seats: 23, aisles: [6,17], zones: [
        { from: 1, to: 23, price: 120 }
      ], gapAfter: true },

      { row: 18, seats: 20, aisles: [10], zones: [
        { from: 1, to: 20, price: 110 }
      ]}
    ]
  }
};

// ===================== РЕНДЕР СХЕМЫ =====================

const SEAT_SIZE = 34; // px — кнопка
const SEAT_GAP  = 6;  // px — промежуток между местами

let selectedSeats = [];

function getPriceForSeat(rowConfig, seatNumber) {
  if (!rowConfig.zones) return 0;
  for (const z of rowConfig.zones) {
    if (seatNumber >= z.from && seatNumber <= z.to) return z.price;
  }
  return 0;
}

function updateSummary() {
  const countEl = document.getElementById("seats-count");
  const sumEl   = document.getElementById("seats-sum");

  const count = selectedSeats.length;
  const sum = selectedSeats.reduce((acc, s) => acc + s.price, 0);

  if (countEl) countEl.textContent = count.toString();
  if (sumEl)   sumEl.textContent   = sum.toString();
}

function renderHall(hallConfig) {
  // корневой контейнер
  let hallRoot = document.getElementById("hall-root");
  if (!hallRoot) {
    hallRoot = document.createElement("div");
    hallRoot.id = "hall-root";
    const summaryBlock = document.getElementById("seats-summary");
    const anchor = summaryBlock || document.body;
    anchor.parentNode.insertBefore(hallRoot, anchor.nextSibling);
  }
  hallRoot.innerHTML = "";

  // сцена
  const stage = document.createElement("div");
  stage.className = "hall-stage";
  stage.textContent = hallConfig.hallName || "Сцена";
  hallRoot.appendChild(stage);

  const grid = document.createElement("div");
  grid.className = "hall-grid";
  hallRoot.appendChild(grid);

  selectedSeats = [];
  updateSummary();

  hallConfig.rows.forEach((rowCfg) => {
    const rowWrapper = document.createElement("div");
    rowWrapper.className = "hall-row";
    if (rowCfg.gapAfter) rowWrapper.classList.add("hall-row-gap-after");

    // подпись ряда
    const label = document.createElement("div");
    label.className = "hall-row-label";
    label.textContent = `Ряд ${rowCfg.row}`;
    rowWrapper.appendChild(label);

    const seatsContainer = document.createElement("div");
    seatsContainer.className = "hall-row-seats";

    if (rowCfg.offset && rowCfg.offset > 0) {
      const offsetDiv = document.createElement("div");
      offsetDiv.style.width = ((SEAT_SIZE + SEAT_GAP) * (rowCfg.offset - 1)) + "px";
      offsetDiv.style.flexShrink = "0";
      seatsContainer.appendChild(offsetDiv);
    }

    for (let seat = 1; seat <= rowCfg.seats; seat++) {
      const price = getPriceForSeat(rowCfg, seat);

      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "hall-seat";
      btn.textContent = seat;
      btn.dataset.row = rowCfg.row;
      btn.dataset.seat = seat;
      btn.dataset.price = price;

      btn.title = `Ряд ${rowCfg.row}, місце ${seat}, ${price} грн`;

      btn.addEventListener("click", () => {
        const key = `${rowCfg.row}-${seat}`;
        const index = selectedSeats.findIndex(s => s.key === key);

        if (index === -1) {
          selectedSeats.push({ key, row: rowCfg.row, seat, price });
          btn.classList.add("hall-seat-selected");
        } else {
          selectedSeats.splice(index, 1);
          btn.classList.remove("hall-seat-selected");
        }

        updateSummary();
      });

      seatsContainer.appendChild(btn);

      if (rowCfg.aisles && rowCfg.aisles.includes(seat)) {
        const aisle = document.createElement("div");
        aisle.className = "hall-aisle";
        seatsContainer.appendChild(aisle);
      }
    }

    rowWrapper.appendChild(seatsContainer);
    grid.appendChild(rowWrapper);
  });
}

// ===================== ИНИЦИАЛИЗАЦИЯ СТРАНИЦЫ =====================

document.addEventListener("DOMContentLoaded", () => {
  try {
    // блок "Вибрано місць: X • Сума: Y"
    let summary = document.getElementById("seats-summary");
    if (!summary) {
      summary = document.createElement("div");
      summary.id = "seats-summary";
      summary.style.margin = "16px 0";
      summary.innerHTML = `
        Вибрано місць: <span id="seats-count">0</span> •
        Сума: <span id="seats-sum">0</span> грн
      `;
      const main = document.querySelector("main") || document.body;
      main.insertBefore(summary, main.firstChild);
    }

    // какой зал показывать — читаем show=shevchenko%2Fza-dvoma-zaytsyamy
    const params = new URLSearchParams(window.location.search);
    const showParam = params.get("show");
    if (!showParam) {
      console.error("Не передан параметр show в URL");
      return;
    }

    const [theatreSlug] = decodeURIComponent(showParam).split("/");
    const hallConfig = HALLS[theatreSlug];

    if (!hallConfig) {
      console.error("Не найден конфиг для театра:", theatreSlug);
      return;
    }

    // подпись над схемой (если есть элементы)
    const titleEl = document.querySelector("[data-hall-title]");
    if (titleEl) {
      titleEl.textContent = hallConfig.hallName;
    }
    const theatreEl = document.querySelector("[data-hall-theatre]");
    if (theatreEl) {
      theatreEl.textContent = hallConfig.theatreName;
    }

    renderHall(hallConfig);
  } catch (e) {
    console.error("Помилка ініціалізації зали:", e);
  }
});
</script>

</body>
</html>
