<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Вибір місць — Ваш Адмін</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="/site-081125/styles.css" />
  <style>
    /* Нейтральні стилі на випадок, якщо у styles.css немає потрібних класів */
    .hall {display:grid; gap:10px; margin:16px 0}
    .hall-row {display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    .hall-row-label {width:80px; text-align:right; font-weight:600; color:#475467}
    .seats {display:flex; gap:6px; flex-wrap:wrap}
    .seat {
      min-width:36px; height:36px; border-radius:8px; border:1px solid #D0D5DD; background:#fff;
      cursor:pointer; font:600 13px/34px system-ui, -apple-system, Segoe UI, Roboto, Ubuntu;
      text-align:center; padding:0 8px; user-select:none;
    }
    .seat.taken {background:#E5E7EB; border-color:#E5E7EB; color:#9CA3AF; cursor:not-allowed}
    .seat.selected {background:#155EEF; color:#fff; border-color:#155EEF}
    .legend{display:flex; gap:14px; align-items:center; flex-wrap:wrap; margin-top:6px; color:#475467}
    .legend > span{display:inline-flex; gap:6px; align-items:center}
    .legend .box{width:16px; height:16px; border:1px solid #D0D5DD; border-radius:4px; background:#fff}
    .legend .sel{background:#155EEF; border-color:#155EEF}
    .legend .dis{background:#E5E7EB; border-color:#E5E7EB}
    .order-form .form-row{display:flex; flex-direction:column; gap:6px; margin:10px 0}
    #summary{margin:8px 0 14px}
  </style>
</head>

<body>
  <div id="site-header"></div>

  <main class="main">
    <section class="section">
      <!-- где-то в <main> -->
<h1>Вибір місць</h1>
<p id="hall-error" style="display:none;color:#c00;margin:8px 0;"></p>
<div id="hall-root"></div>

      <div class="legend">
        <span><span class="box"></span> вільно</span>
        <span><span class="box sel"></span> вибрано</span>
        <span><span class="box dis"></span> зайнято</span>
      </div>

      <form id="order-form" class="order-form">
        <h2 style="margin-top:18px">Дані покупця</h2>

        <div class="form-row">
          <label>Ім’я та прізвище</label>
          <input type="text" name="name" required placeholder="Ваше ім’я та прізвище" autocomplete="name" />
        </div>

        <div class="form-row">
          <label>Телефон</label>
          <input type="tel" name="phone" required placeholder="+380..." inputmode="tel" autocomplete="tel" />
        </div>

        <div class="form-row">
          <label>Електронна пошта (куди надійде PDF-квиток)</label>
          <input type="email" name="email" required placeholder="you@example.com" inputmode="email" autocomplete="email" />
        </div>

        <p id="summary">Вибрано місць: 0 • Сума: 0 грн</p>
        <button type="submit" class="btn primary">Перейти до оплати</button>
      </form>
    </section>
  </main>

  <div id="site-footer"></div>

  <script src="/site-081125/scripts/include.js"></script>
 <script>
(async () => {
  // 1) Контейнеры
  const mount = document.getElementById('hall-root');
  const errBox = document.getElementById('hall-error');
  if (!mount) {
    console.error('Контейнер #hall-root не найден');
    alert('Внутренняя ошибка: отсутствует контейнер #hall-root');
    return;
  }

  // 2) Разбор параметра ?show=theatre/slug
  const urlp = new URLSearchParams(location.search);
  const showParam = urlp.get('show') || '';
  const theatre = showParam.split('/')[0]; // "shevchenko" | "academy" | ...

  // 3) Карта путей к схемам залов
  const HALLS = {
    shevchenko: '/site-081125/data/hall/shevchenko/velyka.json',
    academy:    '/site-081125/data/hall/academy/academy.json',
  };

  // 4) Без падения при ошибках
  function fail(msg) {
    console.error(msg);
    if (errBox) {
      errBox.textContent = msg;
      errBox.style.display = 'block';
    } else {
      alert(msg);
    }
  }

  // 5) Определяем файл схемы
  const hallHref = HALLS[theatre];
  if (!hallHref) {
    fail('Невідомий майданчик у параметрі show: ' + theatre);
    return;
  }

  // 6) Загружаем JSON схемы
  let hall;
  try {
    const r = await fetch(hallHref, { cache: 'no-store' });
    if (!r.ok) throw new Error(hallHref + ' → ' + r.status);
    hall = await r.json();
  } catch (e) {
    fail('Не вдалося завантажити схему залу: ' + hallHref);
    return;
  }

  // 7) Рендерим (здесь только пример «скелета»,
  //    ваш реальный рендер может быть сложнее)
  function renderHall(h) {
    // Простейшая разметка рядами: создаём кнопки мест
    // Поддержка формата: rows: [{row, seats, aisles, left_pad, right_pad, row_break_after}]
    const frag = document.createDocumentFragment();

    (h.rows || []).forEach(rowObj => {
      const rowEl = document.createElement('div');
      rowEl.style.margin = '8px 0';

      const label = document.createElement('span');
      label.textContent = 'Ряд ' + (rowObj.row ?? '');
      label.style.display = 'inline-block';
      label.style.width = '54px';
      rowEl.appendChild(label);

      const leftPad = Number(rowObj.left_pad || 0);
      if (leftPad > 0) {
        const pad = document.createElement('span');
        pad.style.display = 'inline-block';
        pad.style.width = (leftPad * 24) + 'px';
        rowEl.appendChild(pad);
      }

      const totalSeats = Number(rowObj.seats || 0);
      const aisles = Array.isArray(rowObj.aisles) ? rowObj.aisles : [];

      for (let i = 1; i <= totalSeats; i++) {
        if (aisles.includes(i)) {
          const gap = document.createElement('span');
          gap.style.display = 'inline-block';
          gap.style.width = '16px';
          gap.style.height = '1px';
          rowEl.appendChild(gap);
        }
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.type = 'button';
        btn.style.margin = '2px';
        btn.style.minWidth = '32px';
        btn.style.height = '32px';
        rowEl.appendChild(btn);
      }

      const rightPad = Number(rowObj.right_pad || 0);
      if (rightPad > 0) {
        const pad = document.createElement('span');
        pad.style.display = 'inline-block';
        pad.style.width = (rightPad * 24) + 'px';
        rowEl.appendChild(pad);
      }

      frag.appendChild(rowEl);

      if (rowObj.row_break_after) {
        const br = document.createElement('div');
        br.style.height = '16px';
        frag.appendChild(br);
      }
    });

    mount.innerHTML = '';
    mount.appendChild(frag);
  }

  try {
    renderHall(hall);
  } catch (e) {
    console.error(e);
    fail('Помилка побудови схеми залу (невалідний JSON або структура). Див. консоль.');
  }
})();
</script>


</body>
</html>
