<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Вибір місць — Ваш Адмін</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="/site-081125/styles.css" />
</head>

<body>
  <div id="site-header"></div>

  <main class="main">
    <section class="section">
      <h1>Вибір місць</h1>
      <div id="show-title"></div>
      <div id="hall-root"></div>

      <form id="order-form" class="order-form">
        <h2>Дані покупця</h2>

        <div class="form-row">
          <label>Ім’я та прізвище</label>
          <input type="text" name="name" required placeholder="Ваше ім’я та прізвище" />
        </div>

        <div class="form-row">
          <label>Телефон</label>
          <input type="tel" name="phone" required placeholder="+380..." />
        </div>

        <div class="form-row">
          <label>Електронна пошта (куди надійде PDF-квиток)</label>
          <input type="email" name="email" required placeholder="you@example.com" />
        </div>

        <p id="summary">Вибрано місць: 0 • Сума: 0 грн</p>
        <button type="submit" class="btn primary">Перейти до оплати</button>
      </form>
    </section>
  </main>

  <div id="site-footer"></div>

  <script src="/site-081125/scripts/include.js"></script>
  <script>
    // --- 1. Отримуємо slug вистави з URL
    const qp = new URLSearchParams(location.search);
    const slug = qp.get('show') || qp.get('slug') || '';

    // --- 2. Визначаємо, який театр: academy чи shevchenko
    async function resolveTheatre() {
      try {
        const afisha = await fetch('/site-081125/data/schedule/afisha.json', {cache:'no-store'}).then(r=>r.json());
        const item = (afisha || []).find(x => (x.slug || x.show || '') === slug);
        if (item && item.theatre) return item.theatre.toLowerCase();
      } catch(e) {
        console.warn('afisha.json не знайдено або помилка в JSON');
      }

      // Якщо в афіші не знайдено — перевіряємо вручну
      const tryPaths = [
        '/site-081125/data/shows/academy/' + slug + '.json',
        '/site-081125/data/shows/shevchenko/' + slug + '.json'
      ];
      for (const url of tryPaths) {
        const res = await fetch(url, {method:'HEAD'});
        if (res.ok) {
          if (url.includes('/academy/')) return 'academy';
          return 'shevchenko';
        }
      }
      return 'shevchenko';
    }

    // --- 3. Завантажуємо правильну схему залу
    (async () => {
      const theatre = await resolveTheatre();
      const hallFile = theatre === 'academy' ? 'academy.json' : 'shevchenko.json';
      const HALL_URL = '/site-081125/data/halls/' + hallFile;

      try {
        const hall = await fetch(HALL_URL, {cache:'no-store'}).then(r=>r.json());
        console.log('Схема завантажена:', HALL_URL, hall);

        // Якщо є твоя функція для ініціалізації зали — виклич її
        if (typeof initHall === 'function') {
          initHall(hall);
        } else {
          // Тимчасово для перевірки — показуємо кількість рядів
          const hallRoot = document.getElementById('hall-root');
          hallRoot.innerHTML = `<p>Завантажено схему "${theatre}" (${hall.rows.length} рядів)</p>`;
        }

      } catch (e) {
        console.error('Помилка завантаження схеми залу:', e);
        document.getElementById('hall-root').innerHTML = '<p style="color:red">Не вдалося завантажити схему залу.</p>';
      }
    })();
  </script>
</body>
</html>
