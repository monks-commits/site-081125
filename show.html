<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Вистава — Ваш Адмін</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div id="site-header"></div>

  <main class="main">
    <nav style="margin:8px 0 16px;">
      <a href="./afisha.html">Афіша</a> ·
      <a href="./theatres.html">Театри</a> ·
      <a href="./contacts.html">Контакти</a>
    </nav>

    <section class="section">
      <div id="show-wrap"></div>
      <p id="show-error" style="color:#b91c1c;display:none;margin-top:12px"></p>
    </section>
  </main>

  <div id="site-footer"></div>

  <!-- важный путь: без /site-081125 -->
  <script src="/scripts/include.js"></script>

  <script>
    const params = new URLSearchParams(location.search);
    const slug = params.get('slug') || 'shevchenko/za-dvoma-zaytsiamy';
    const DATA_URL = '/data/shows/' + slug + '.json';

    const wrap = document.getElementById('show-wrap');
    const err  = document.getElementById('show-error');

    function fmtDate(iso){
      const d = new Date(iso);
      const fmt = new Intl.DateTimeFormat('uk-UA', { dateStyle:'medium', timeStyle:'short' });
      return isNaN(d) ? '' : fmt.format(d);
    }

    function view(data){
      const poster = data.poster
        ? `<img src="${data.poster}" alt="${data.title}" class="show-poster-img">`
        : '';

      const metaParts = [
        data.city,
        data.hall,
        data.theatre ? ('Майданчик: ' + data.theatre) : null,
        data.date ? ('Дата: ' + fmtDate(data.date)) : null,
        data.duration ? ('Тривалість: ' + data.duration) : null,
        data.scene ? ('Сцена: ' + data.scene) : null
      ].filter(Boolean);

      const meta = metaParts.join(' • ');

      const hallLink = '/spectacles/hall.html?show=' + encodeURIComponent(slug);

      wrap.innerHTML = `
        <div class="show-layout">
          <div class="show-poster">
            ${poster || ''}
          </div>
          <div class="show-info">
            <h1>${data.title || 'Вистава'}</h1>
            ${meta ? `<p class="show-meta" style="color:#475569;margin:6px 0 12px;">${meta}</p>` : ''}
            ${data.description ? `<div class="show-description" style="margin:10px 0 16px;line-height:1.5">${data.description}</div>` : ''}
            <p style="margin-top:10px;">
              <a class="button-primary" href="${hallLink}">Обрати місця</a>
            </p>
          </div>
        </div>
      `;
    }

    fetch(DATA_URL, { cache:'no-store' })
      .then(r => r.text())
      .then(txt => {
        try {
          const data = JSON.parse(txt);
          view(data);
        } catch (e) {
          console.error('JSON parse error:', e);
          err.textContent = 'Помилка у файлі опису вистави: ' + DATA_URL + '. Перевірте JSON (кома/лапки).';
          err.style.display = 'block';
          view({ title:'Вистава', description:'Опис недоступний.', poster:'', city:'', hall:'', scene:'Велика сцена' });
        }
      })
      .catch(e => {
        console.error(e);
        err.textContent = 'Не вдалося завантажити опис вистави.';
        err.style.display = 'block';
      });
  </script>
</body>
</html>
