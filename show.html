<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Вистава — Ваш Адмін</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div id="site-header"></div>

  <main class="main">
    <nav style="margin:8px 0 16px;">
      <a href="./afisha.html">Афіша</a> ·
      <a href="./theatres.html">Театри</a> ·
      <a href="./contacts.html">Контакти</a>
    </nav>

    <section class="section">
      <div id="show-wrap"></div>
      <p id="show-error" style="color:#b91c1c;display:none;margin-top:12px"></p>
    </section>
  </main>

  <div id="site-footer"></div>
  <script src="/site-081125/scripts/include.js"></script>
  <script>
    const params = new URLSearchParams(location.search);
    const slug = params.get('slug') || 'shevchenko/za-dvoma-zaytsiamy';
    const DATA_URL = '/site-081125/data/shows/' + slug + '.json';

    const wrap = document.getElementById('show-wrap');
    const err  = document.getElementById('show-error');

    function fmtDate(iso){
      const d = new Date(iso);
      const fmt = new Intl.DateTimeFormat('uk-UA', { dateStyle:'medium', timeStyle:'short' });
      return isNaN(d) ? '' : fmt.format(d);
    }

    function view(data){
      const poster = data.poster ? `<img src="${data.poster}" alt="${data.title}" style="max-width:220px;width:100%;border-radius:12px">` : '';
      const meta   = [
        data.city, data.hall,
        data.theatre ? ('Майданчик: ' + data.theatre) : null,
        data.date ? ('Дата: ' + fmtDate(data.date)) : null,
        data.duration ? ('Тривалість: ' + data.duration) : null,
        data.scene ? ('Сцена: ' + data.scene) : null
      ].filter(Boolean).join(' • ');

      const hallLink = '/site-081125/spectacles/hall.html?show=' + encodeURIComponent(slug);

      wrap.innerHTML = `
        <div style="display:grid;grid-template-columns:220px 1fr;gap:18px;align-items:start;max-width:980px">
          <div>${poster}</div>
          <div>
            <h1>${data.title || 'Вистава'}</h1>
            <p style="color:#475569">${meta}</p>
            ${data.description ? `<div style="margin:14px 0;line-height:1.5">${data.description}</div>` : ''}
            <a class="btn" href="${hallLink}">Обрати місця</a>
          </div>
        </div>
      `;
    }

    fetch(DATA_URL, { cache:'no-store' })
      .then(r => r.text())
      .then(txt => {
        // Захист від битого JSON: покажемо помилку, але не роняємо сторінку
        try {
          const data = JSON.parse(txt);
          view(data);
        } catch (e) {
          console.error('JSON parse error:', e);
          err.textContent = 'Помилка у файлі опису вистави: ' + DATA_URL + '. Перевірте JSON (кома/лапки).';
          err.style.display = 'block';
          // мінімальний фолбек, щоб була кнопка в зал
          view({ title:'Вистава', description:'Опис недоступний.', poster:'', city:'', hall:'', scene:'Велика сцена' });
        }
      })
      .catch(e => {
        console.error(e);
        err.textContent = 'Не вдалося завантажити опис вистави.';
        err.style.display = 'block';
      });
  </script>
</body>
</html>
